
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>VK Постер — Готово</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
    input, button { padding: 10px; font-size: 16px; margin-top: 10px; }
    pre { background: #eee; padding: 10px; max-height: 300px; overflow-y: auto; }
  </style>
</head>
<body>
  <h2>VK Постер — выкладка от авторов</h2>

  <label>Access Token:</label><br>
  <input type="text" id="access_token" disabled style="width: 100%;"><br>

  <button onclick="checkPosts()">Проверить посты</button>
  <button onclick="postAll()">Выложить всё</button>
  <pre id="log"></pre>

<script>
  const TOKEN = "vk1.really_long_token_example_for_demo_1234567890"; // встроенный токен
  const OWNER_ID = -136706358;
  document.getElementById("access_token").value = TOKEN;

  function log(text) {
    const pre = document.getElementById("log");
    pre.textContent += `[${new Date().toLocaleTimeString()}] ${text}
`;
    pre.scrollTop = pre.scrollHeight;
  }

  async function checkPosts() {
    log("Проверка постов...");
    const res = await fetch(`https://api.vk.com/method/wall.get?owner_id=${OWNER_ID}&filter=suggests&count=100&access_token=${TOKEN}&v=5.199`);
    const data = await res.json();
    if (data.error) {
      log("Ошибка: " + data.error.error_msg);
      return;
    }
    const passed = data.response.items.filter(post =>
      /(?:\+7|8)?[\s\-]?\(?\d{3}\)?[\s\-]?\d{3}[\s\-]?\d{2}[\s\-]?\d{2}/.test(post.text)
    );
    log(`Проверено ${data.response.items.length}, прошло фильтр: ${passed.length}`);
  }

  async function postAll() {
    log("Выкладка постов...");
    const res = await fetch(`https://api.vk.com/method/wall.get?owner_id=${OWNER_ID}&filter=suggests&count=100&access_token=${TOKEN}&v=5.199`);
    const data = await res.json();
    if (data.error) {
      log("Ошибка: " + data.error.error_msg);
      return;
    }
    for (const post of data.response.items) {
      await fetch("https://api.vk.com/method/wall.post", {
        method: "POST",
        body: new URLSearchParams({
          owner_id: OWNER_ID,
          from_group: "0",
          message: post.text,
          access_token: TOKEN,
          v: "5.199"
        })
      });
      await fetch("https://api.vk.com/method/wall.delete", {
        method: "POST",
        body: new URLSearchParams({
          owner_id: OWNER_ID,
          post_id: post.id,
          access_token: TOKEN,
          v: "5.199"
        })
      });
      log(`Выложен и удалён из предложки: ${post.id}`);
      await new Promise(r => setTimeout(r, 10000)); // задержка 10 сек
    }
  }
</script>
</body>
</html>
